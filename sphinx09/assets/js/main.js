// import AllQuestionsFromQuiz from './../quiz/questions.json';

var AllQuestionsFromQuiz =
{
    "es":
    {
        0:
        {
            question: "¿Cuál de estos animales es un visón europeo?",
            choices: {
                1: {
                    "image":"./../assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Éste es un visón americano. Es una especie exótica, introducida desde Norteamérica por la industria peletera. Es más grande que el visón europeo, sólo encontramos el color blanco de la cara en el labio inferior y el tono del color del pelo es más variable, llegando a ser marrón oscuro a casi negro."
                },
                2: {
                    "image":"/../assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"Éste es un visón europeo. Es más pequeño que el visón americano, los labios superior e inferior son de color blanco y el pelaje es marrón chocolate."
                },
                3: {
                    "image":"/../assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Éste es un turón. De tamaño parecido al del visón europeo. La cara presenta un “antifaz” blanco y una estrecha franja blanca también en las orejas. El pelaje de los costados, entre las patas delanteras y las traseras, tiene un tono más claro, de color amarillento. "
                },
                4: {
                    "image":"/../assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Ésta es una nutria. De tamaño mucho más grande que el visón europeo, con cola larga y gruesa. El cuello tiene una mancha de color blanco sucio a modo de “babero”.  Con pelaje muy denso e impermeable."
                }
            },
            answer: "2"
        },
        1:
        {
            question: "¿Cuál de estos animales es un visón europeo?",
            choices: {
                1: {
                    "image":"./../assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Éste es un visón americano. Es una especie exótica, introducida desde Norteamérica por la industria peletera. Es más grande que el visón europeo, sólo encontramos el color blanco de la cara en el labio inferior y el tono del color del pelo es más variable, llegando a ser marrón oscuro a casi negro."
                },
                2: {
                    "image":"/../assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"Éste es un visón europeo. Es más pequeño que el visón americano, los labios superior e inferior son de color blanco y el pelaje es marrón chocolate."
                },
                3: {
                    "image":"/../assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Éste es un turón. De tamaño parecido al del visón europeo. La cara presenta un “antifaz” blanco y una estrecha franja blanca también en las orejas. El pelaje de los costados, entre las patas delanteras y las traseras, tiene un tono más claro, de color amarillento. "
                },
                4: {
                    "image":"/../assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Ésta es una nutria. De tamaño mucho más grande que el visón europeo, con cola larga y gruesa. El cuello tiene una mancha de color blanco sucio a modo de “babero”.  Con pelaje muy denso e impermeable."
                }
            },
            answer: "2"
        },
        2:
        {
            question: "¿Cuál de estos animales es un visón europeo?",
            choices: {
                1: {
                    "image":"./../assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Éste es un visón americano. Es una especie exótica, introducida desde Norteamérica por la industria peletera. Es más grande que el visón europeo, sólo encontramos el color blanco de la cara en el labio inferior y el tono del color del pelo es más variable, llegando a ser marrón oscuro a casi negro."
                },
                2: {
                    "image":"/../assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"Éste es un visón europeo. Es más pequeño que el visón americano, los labios superior e inferior son de color blanco y el pelaje es marrón chocolate."
                },
                3: {
                    "image":"/../assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Éste es un turón. De tamaño parecido al del visón europeo. La cara presenta un “antifaz” blanco y una estrecha franja blanca también en las orejas. El pelaje de los costados, entre las patas delanteras y las traseras, tiene un tono más claro, de color amarillento. "
                },
                4: {
                    "image":"/../assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Ésta es una nutria. De tamaño mucho más grande que el visón europeo, con cola larga y gruesa. El cuello tiene una mancha de color blanco sucio a modo de “babero”.  Con pelaje muy denso e impermeable."
                }
            },
            answer: "2"
        },
        3:
        {
            question: "¿Cuál de estos animales es un visón europeo?",
            choices: {
                1: {
                    "image":"./../assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Éste es un visón americano. Es una especie exótica, introducida desde Norteamérica por la industria peletera. Es más grande que el visón europeo, sólo encontramos el color blanco de la cara en el labio inferior y el tono del color del pelo es más variable, llegando a ser marrón oscuro a casi negro."
                },
                2: {
                    "image":"/../assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"Éste es un visón europeo. Es más pequeño que el visón americano, los labios superior e inferior son de color blanco y el pelaje es marrón chocolate."
                },
                3: {
                    "image":"/../assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Éste es un turón. De tamaño parecido al del visón europeo. La cara presenta un “antifaz” blanco y una estrecha franja blanca también en las orejas. El pelaje de los costados, entre las patas delanteras y las traseras, tiene un tono más claro, de color amarillento. "
                },
                4: {
                    "image":"/../assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Ésta es una nutria. De tamaño mucho más grande que el visón europeo, con cola larga y gruesa. El cuello tiene una mancha de color blanco sucio a modo de “babero”.  Con pelaje muy denso e impermeable."
                }
            },
            answer: "2"
        },
        4:
        {
            question: "¿Cuál de estos animales es un visón europeo?",
            choices: {
                1: {
                    "image":"./../assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Éste es un visón americano. Es una especie exótica, introducida desde Norteamérica por la industria peletera. Es más grande que el visón europeo, sólo encontramos el color blanco de la cara en el labio inferior y el tono del color del pelo es más variable, llegando a ser marrón oscuro a casi negro."
                },
                2: {
                    "image":"/../assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"Éste es un visón europeo. Es más pequeño que el visón americano, los labios superior e inferior son de color blanco y el pelaje es marrón chocolate."
                },
                3: {
                    "image":"/../assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Éste es un turón. De tamaño parecido al del visón europeo. La cara presenta un “antifaz” blanco y una estrecha franja blanca también en las orejas. El pelaje de los costados, entre las patas delanteras y las traseras, tiene un tono más claro, de color amarillento. "
                },
                4: {
                    "image":"/../assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Ésta es una nutria. De tamaño mucho más grande que el visón europeo, con cola larga y gruesa. El cuello tiene una mancha de color blanco sucio a modo de “babero”.  Con pelaje muy denso e impermeable."
                }
            },
            answer: "2"
        }
    }
};
var questions = [];
var choices = [];
var correct = 0;
var unanswered = 0;
var timer;

var splashPage = document.getElementById('splash');
var questionContainer = document.getElementById('selector-container');
var questionText = document.getElementById('question-text');

var option1 = document.getElementById('option-1-container');
var option2 = document.getElementById('option-2-container');
var option3 = document.getElementById('option-3-container');
var option4 = document.getElementById('option-4-container');

var option1Text = option1.getElementsByTagName('span')[0];
var option2Text = option2.getElementsByTagName('span')[0];
var option3Text = option3.getElementsByTagName('span')[0];
var option4Text = option4.getElementsByTagName('span')[0];

var option1Solution = option1.getElementsByClassName('solution-text')[0];
var option2Solution = option2.getElementsByClassName('solution-text')[0];
var option3Solution = option3.getElementsByClassName('solution-text')[0];
var option4Solution = option4.getElementsByClassName('solution-text')[0];

var option1ImageFront = option1.getElementsByClassName('image')[0];
var option2ImageFront = option2.getElementsByClassName('image')[0];
var option3ImageFront = option3.getElementsByClassName('image')[0];
var option4ImageFront = option4.getElementsByClassName('image')[0];


var option1ImageBack = option1.getElementsByClassName('image')[1];
var option2ImageBack = option2.getElementsByClassName('image')[1];
var option3ImageBack = option3.getElementsByClassName('image')[1];
var option4ImageBack = option4.getElementsByClassName('image')[1];

var answer = document.getElementById('answer');

document.addEventListener("keydown", KeyPressedHandler);

function KeyPressedHandler(e) {
    if (splashPage.classList.contains('hide')) {
        resolveQuestion(e);
    } else {
        selectLanguage(e);
    }
}

function selectLanguage(e) {
    var locale = 'es';

    launchQuiz(locale);
}

function launchQuiz(locale) {
    questions = shuffleQuestions(locale);
    hideSelector(splashPage);
    showSelector(questionContainer);
    showNextQuestion();
}

function shuffleQuestions(locale) {
    var sortedQuestions = [];
    var localeQuestions = AllQuestionsFromQuiz[locale];
    for (var i in localeQuestions)
    {
        sortedQuestions.push([i, localeQuestions[i]]);
    }
    // import AllQuestionsFromQuiz from './../quiz/questions.json';
    questions = shuffle(sortedQuestions);
    
    return sortedQuestions;

}

function hideSelector(selector) {
    selector.className = "hide";

}

function showSelector(selector) {
    selector.className = "flex";
}

function showNextQuestion() {
    clearInterval(timer);
    if (questions.length == 0) {
        showResults()
    } else {
        var currentQuestion = questions.pop();
        var question = currentQuestion[1];
        var inquire = question['question'];
        var solution = question['answer'];
        choices = question['choices'];
        
        var inquireText = document.createTextNode(inquire);
        var choice1Picture = document.createElement('img');
        var choice2Picture = document.createElement('img');
        var choice3Picture = document.createElement('img');
        var choice4Picture = document.createElement('img');
        
        var choice1Node = document.createTextNode("text" in choices[1] ? choices[1]["text"] : '');
        var choice2Node = document.createTextNode("text" in choices[2] ? choices[2]["text"] : '');
        var choice3Node = document.createTextNode("text" in choices[3] ? choices[3]["text"] : '');
        var choice4Node = document.createTextNode("text" in choices[4] ? choices[4]["text"] : '');
        
        var solutionNode = document.createTextNode(solution);
        

        choice1Picture.src="image" in choices[1] ? choices[1]["image"] : '';
        choice2Picture.src="image" in choices[2] ? choices[2]["image"] : '';
        choice3Picture.src="image" in choices[3] ? choices[3]["image"] : '';
        choice4Picture.src="image" in choices[4] ? choices[4]["image"] : '';
        
        questionText.append(inquireText);

        option1Text.append(choice1Node);
        option2Text.append(choice2Node);
        option3Text.append(choice3Node);
        option4Text.append(choice4Node);
            
        option1ImageFront.append(choice1Picture);
        option2ImageFront.append(choice2Picture);
        option3ImageFront.append(choice3Picture);
        option4ImageFront.append(choice4Picture);
        
        answer.append(solutionNode);
    }
    countdownTimer()
}

function resolveQuestion(e) {
    unanswered = 0;
    clearInterval(timer);

    var correctFlag = false;
    var keyPressed = e.key;
    var correctAnswer = answer.childNodes[0].data;
    if (keyPressed == correctAnswer) {
        correct++;
        correctFlag = true;
    }

    option1.getElementsByClassName('flip-card')[0].classList.add('hover');
    option2.getElementsByClassName('flip-card')[0].classList.add('hover');
    option3.getElementsByClassName('flip-card')[0].classList.add('hover');
    option4.getElementsByClassName('flip-card')[0].classList.add('hover');

    var choice1Solution = document.createTextNode("solution" in choices[1] ? choices[1]["solution"] : '');
    var choice2Solution = document.createTextNode("solution" in choices[2] ? choices[2]["solution"] : '');
    var choice3Solution = document.createTextNode("solution" in choices[3] ? choices[3]["solution"] : '');
    var choice4Solution = document.createTextNode("solution" in choices[4] ? choices[4]["solution"] : '');

    option1Solution.append(choice1Solution);
    option2Solution.append(choice2Solution);
    option3Solution.append(choice3Solution);
    option4Solution.append(choice4Solution);

    sleep(4000).then(() => clearQuestion());
    sleep(4000).then(() => showNextQuestion());
}

function clearQuestion() {
    option1.classList.remove("text-muted", "text-success", "text-danger");
    option2.classList.remove("text-muted", "text-success", "text-danger");
    option3.classList.remove("text-muted", "text-success", "text-danger");

    option1.getElementsByClassName('flip-card')[0].classList.remove('hover');
    option2.getElementsByClassName('flip-card')[0].classList.remove('hover');
    option3.getElementsByClassName('flip-card')[0].classList.remove('hover');
    option4.getElementsByClassName('flip-card')[0].classList.remove('hover');

    option1Text.innerText = '';
    option2Text.innerText = '';
    option3Text.innerText = '';
    option4Text.innerText='';

    option1Solution.innerText='';
    option2Solution.innerText='';
    option3Solution.innerText='';
    option4Solution.innerText='';

    option1ImageFront.innerHTML = '';
    option2ImageFront.innerHTML = '';
    option3ImageFront.innerHTML = '';
    option4ImageFront.innerHTML = '';

    questionText.innerText = '';
    answer.innerText='';
}

function shuffle(a) {
    var j, x, i;
    for (i = a.length - 1; i > 0; i--) {
        j = Math.floor(Math.random() * (i + 1));
        x = a[i];
        a[i] = a[j];
        a[j] = x;
    }
    return a;
}

async function countdownTimer()
{
    if (unanswered >3) {
        showResults();
    }
    timer = setInterval(() => {
        sleep(500).then(() => clearQuestion());
        sleep(500).then(() => showNextQuestion());
        unanswered++;
        showNextQuestion();
    }, 5000);
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

function showResults()
{
    var inquireText = document.createTextNode(correct);
    questionText.append(inquireText);
    sleep(1000).then(() => location.reload());
}
