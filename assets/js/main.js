// import AllQuestionsFromQuiz from './../quiz/questions.json';

var AllQuestionsFromQuiz =





{
    "es":
    {
        0:
        {
            question: "¿Cuál de estos animales es un visón europeo?",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Éste es un visón americano. Es una especie exótica, introducida desde Norteamérica por la industria peletera. Es más grande que el visón europeo, sólo encontramos el color blanco de la cara en el labio inferior y el tono del color del pelo es más variable, llegando a ser marrón oscuro a casi negro."
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"Éste es un visón europeo. Es más pequeño que el visón americano, los labios superior e inferior son de color blanco y el pelaje es marrón chocolate."
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Éste es un turón. De tamaño parecido al del visón europeo. La cara presenta un “antifaz” blanco y una estrecha franja blanca también en las orejas. El pelaje de los costados, entre las patas delanteras y las traseras, tiene un tono más claro, de color amarillento. "
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Ésta es una nutria. De tamaño mucho más grande que el visón europeo, con cola larga y gruesa. El cuello tiene una mancha de color blanco sucio a modo de “babero”.  Con pelaje muy denso e impermeable."
                }
            },
            answer: [2]
        },
        1:
        {
            question: "¿Serías capaz de distinguir entre estas huellas de patas delanteras, cuál es la que corresponde al visón europeo?",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Huellas de visón europeo.<br /> Longitud de unos 2 a 3 cm, con forma de “media estrella”, más ancha que larga, con los dedos muy separados. "
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"Huellas de gato montés <br />Redondea. Las uñas no dejan marcas en el suelo porque son retráctiles. "
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Huellas de zorro  <br />Huella ovalada, más alargada que ancha. Las uñas dejan una marca en el suelo muy visible. "
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Huellas de nutria <br />De forma circular, de unos 6 cm de diámetro, con uñas muy poco marcadas. En ocasiones puede verse el dibujo que deja la membrana interdigital"
                }
            },
            answer: [1]
        },
        2:
        {
            question: "¿De estos mamíferos, cuál crees que es el más amenazado?",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Lince ibérico.<br />Catalogado por UICN como en peligro de extinción. <br />NO ES EL MAMÍFERO MÁS AMENAZADO DE LOS QUE VES."
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"Visón europeo. <br />Catalogado por UICN como en peligro crítico de extinción. <br />ES EL MAMÍFERO MÁS AMENAZADO DE LOS QUE VES"
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Oso pardo. <br />Aunque en España se encuentra en peligro de extinción, la catalogación UICN mediterránea lo contempla como vulnerable . <br />NO ES EL MAMÍFERO MÁS AMENAZADO DE LOS QUE VES"
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Desmán ibérico. <br />Catalogado por UICN como vulnerable<br />NO ES EL MAMÍFERO MÁS AMENAZADO DE LOS QUE VES"
                }
            },
            answer: [2]
        },
        3:
        {
            question: "¿De estos hábitats, cuál crees que es el que preferiría para vivir un visón europeo?",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Ésta es una zona esteparia sin zonas con agua para encontrar alimento ni vegetación que permitiera al visón europeo esconderse."
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"Aquí un visón europeo tiene disponible una zona con agua, pero no encontraría refugio porque falta vegetación en la ribera y tampoco encontraría comida porque en los ríos canalizados no sobreviven las presas del visón"
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Éste es un río sin canalizar, con agua suficiente y que discurre a una velocidad lenta, ideal para albergar presas. Además hay mucha vegetación para poder esconderse y tener a sus crías."
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Ésta es una zona de río con muchos rápidos. A los visones les costaría mucho esfuerzo nadar y encontrar comida."
                }
            },
            answer: [3]
        },
        4:
        {
            question: "¿A qué familia de mamíferos carnívoros crees que pertenece el visón europeo?",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Cánidos<br />NO<br />Los cánidos tienen las patas largas y delgadas, orejas grandes y puntiagudas y hocico largo y estrecho"
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"Felinos<br />NO<br />Los felinos llevan las uñas escondidas (salvo el guepardo) y sólo las sacan cuando las necesitan para cazar. Tienen el hocico corto y la cabeza redondeada"
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Mustélidos<br />¡CORRECTO!<br />Cuerpo alargado, patas cortas, morro alargado pero ancho y orejas pequeñas, como la nutria de la foto"
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Vivérridos<br />NO<br />Los vivérridos se parecen a los gatos, pero tienen el hocico muy alargado y sus uñas son semi-retráctiles"
                }
            },
            answer: [3]
        },
        5:
        {
            question: " ¿Cuál crees que es el método que se utiliza para capturar a los visones americanos que expulsan al visón europeo?",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"",
                    "solution":"Sería muy difícil capturar un visón de esta manera. Primero   habría que localizarlo en el río, son muy rápidos y nadan muy bien. "
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"",
                    "solution":"A los visones americanos les gusta estar dentro del agua más que a los europeos. Se colocan unas jaulas trampa flotantes que capturan a los visones vivos"
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"",
                    "solution":"Jamás se le ocurriría a un amante de la naturaleza colocar un cepo. Provocan lesiones a los animales que quedan atrapados y no son selectivos, así que podría causar daño a cualquier animal e incluso a personas."
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"",
                    "solution":"Éstas son redes de niebla que los científicos utilizan para capturar aves y realizar estudios."
                }
            },
            answer: [2]
        },
        6:
        {
            question: "¿Por qué crees que el visón americano es una amenaza para el europeo?. Hay varias respuestas correctas",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"El visón americano es más grande y más fuerte.",
                    "solution":"Eso le permite capturar presas más grandes y expulsar al visón europeo si se encuentra con uno."
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"Porque el visón americano ve mucho mejor por la noche",
                    "solution":"Los dos ven igual de bien y pueden localizar a sus presas y orientarse con poca luz "
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"El visón americano tiene más crías en cada parto y es menos territorial.",
                    "solution":"Así la población crece muy rápidamente y se pueden  encontrar muchos visones americanos en un tramo pequeño del río"
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"El visón americano puede comer hierba si lo necesita para sobrevivir.",
                    "solution":"Las dos especies de visón son carnívoros. Ninguno de los dos se alimenta de vegetales."
                }
            },
            answer: [1,3]
        },
        7:
        {
            question: "¿Cómo podemos saber si en un río hay visones americanos?<br />Varias respuestas son correctas",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"Se colocan plataformas flotantes con huelleros de arcilla ",
                    "solution":"Los visones americanos pasan más tiempo en el agua que los europeos, se suelen subir a las plataformas y dejar sus huellas sobre ellas. Luego se capturan vivos en esas mismas plataformas con jaulas trampa para estar completamente seguros de que son visones americanos "
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"Se dedican horas a mirar desde un punto stratégico con buena visibilidad usando prismáticos",
                    "solution":"Se invertiría mucho tiempo y esfuerzo para conseguir localizar a cada visón."
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"Se sobrevuela con helicópteros los ríos en busca de los visones",
                    "solution":"Los visones son muy pequeños, durante el día permanecen escondidos y el ruido les asustaría."
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"A veces aparecen individuos atropellados, así que se habla con el servicio de guarderío",
                    "solution":"Los guardas tienen formación para saber identificar a los visones y recorren los diferentes territorios, por lo que pueden aportar información muy valiosa"
                }
            },
            answer: [1,4]
        },
        8:
        {
            question: "¿Sabes cómo son los centros en los que se reproducen los visones en cautividad?",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"Son centros construidos a lo largo de un río, con diferentes recintos que incluye cada uno un fragmento de éste y con una pareja de visones en cada recinto.",
                    "solution":"Así es muy difícil controlar el recinto, crecidas del río, fugas de visones, reproducción, el estado de los ejemplares etc."
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"Están formados por instalaciones muy grandes con varios machos y varias hembras.",
                    "solution":"FLos visones europeos son muy territoriales y habría peleas continuas que perjudicarían la reproducción y podrían provocar la muerte de varios ejemplares "
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"Se disponen instalaciones contiguas adaptadas a las necesidades de los visones, y se van moviendo de unas a otras dependiendo de las necesidades.",
                    "solution":"Los machos se juntan con las hembras en la época apropiada, se controla la reproducción, el estado de las crías y los adultos etc."
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"En jaulas pequeñas, contiguas la una a la otra",
                    "solution":"Así se crían los visones americanos porque se utilizan para la industria peletera desde hace muchos años, como las gallinas o los conejos en las granjas. Los visones europeos necesitan un ambiente más naturalizado"
                }
            },
            answer: [3]
        },
        9:
        {
            question: "¿Cómo se preparan los visones europeos para su liberación?",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"Se liberan sin demasiada preparación, cuando han crecido lo suficiente para no depender de su madre",
                    "solution":"Si son liberados y no consiguen cazar y alimentarse pronto, se debilitarían y morirían de hambre en poco tiempo"
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"Se juntan primero en recintos más grandes en los que conviven con otros visones y aprenden a cazar fijándose en cómo lo hacen otros.",
                    "solution":"Los visones son muy territoriales. No aprenderían unos de otros, sino que pelearían entre ellos"
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"Se mantienen de forma individual en jaulones pre-suelta en los que utilizan su instinto para aprender a cazar presas que les suministran los cuidadores.",
                    "solution":"Se minimiza el contacto con las personas y se sueltan peces vivos, cangrejos etc para que practiquen la caza antes de ser liberados."
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"Se liberan cerca de poblaciones humanas, para que puedan acercarse a zonas donde hay restos de comida, por si no consiguen cazar",
                    "solution":"Cerca de poblaciones hay muchos peligros: gatos, erros, posibilidad de atropellos..."
                }
            },
            answer: [3]
        },
        10:
        {
            question: "¿Cómo se vigilan los visones europeos que han sido liberados?",
            choices: {
                1: {
                    "image":"./assets/images/neovison.jpg",
                    "text":"Se colocan jaulas trampa para capturarlos cada cierto tiempo",
                    "solution":"Es muy importante saber si los esfuerzos dan  resultado y los visones sobreviven, o hay aspectos que hay que modificar.Hay que evitar molestarles en exceso y al final reconocerían las jaulas y decidirían no entrar en ellas."
                },
                2: {
                    "image":"./assets/images/mustela_lutreola.png",
                    "text":"No se controlan para evitar molestarlos",
                    "solution":"Felinos<br />NO<br />Los felinos llevan las uñas escondidas (salvo el guepardo) y sólo las sacan cuando las necesitan para cazar. Tienen el hocico corto y la cabeza redondeada"
                },
                3: {
                    "image":"./assets/images/mustela_putorius.jpg",
                    "text":"Se les coloca un transmisor con un collar ",
                    "solution":"Esto permite saber dónde están sin interferir demasiado en su vida y localizarlos si han muerto."
                },
                4: {
                    "image":"./assets/images/lutra.jpg",
                    "text":"Se les vigila buscándolos sólo con la ayuda de los prismáticos",
                    "solution":"Sería muy complicado. Ni siquiera sabríamos si se han ido o siguen en la zona en la que se liberaron."
                }
            },
            answer: [3]
        }
    }
};
var questions = [];
var choices = [];
var correct = 0;
var unanswered = 0;
var timer;

var splashPage = document.getElementById('splash');
var questionContainer = document.getElementById('selector-container');
var questionText = document.getElementById('question-text');

var option1 = document.getElementById('option-1-container');
var option2 = document.getElementById('option-2-container');
var option3 = document.getElementById('option-3-container');
var option4 = document.getElementById('option-4-container');

var option1Text = option1.getElementsByTagName('span')[0];
var option2Text = option2.getElementsByTagName('span')[0];
var option3Text = option3.getElementsByTagName('span')[0];
var option4Text = option4.getElementsByTagName('span')[0];

var option1Solution = option1.getElementsByClassName('solution-text')[0];
var option2Solution = option2.getElementsByClassName('solution-text')[0];
var option3Solution = option3.getElementsByClassName('solution-text')[0];
var option4Solution = option4.getElementsByClassName('solution-text')[0];

var option1ImageFront = option1.getElementsByClassName('image')[0];
var option2ImageFront = option2.getElementsByClassName('image')[0];
var option3ImageFront = option3.getElementsByClassName('image')[0];
var option4ImageFront = option4.getElementsByClassName('image')[0];


var option1ImageBack = option1.getElementsByClassName('image')[1];
var option2ImageBack = option2.getElementsByClassName('image')[1];
var option3ImageBack = option3.getElementsByClassName('image')[1];
var option4ImageBack = option4.getElementsByClassName('image')[1];

var answer = document.getElementById('answer');

document.addEventListener("keydown", KeyPressedHandler);

function KeyPressedHandler(e) {
    if (splashPage.classList.contains('hide')) {
        resolveQuestion(e);
    } else {
        selectLanguage(e);
    }
}

function selectLanguage(e) {
    var locale = 'es';

    launchQuiz(locale);
}

function launchQuiz(locale) {
    questions = shuffleQuestions(locale);
    hideSelector(splashPage);
    showSelector(questionContainer);
    showNextQuestion();
}

function shuffleQuestions(locale) {
    var sortedQuestions = [];
    var localeQuestions = AllQuestionsFromQuiz[locale];
    for (var i in localeQuestions)
    {
        sortedQuestions.push([i, localeQuestions[i]]);
    }
    // import AllQuestionsFromQuiz from './../quiz/questions.json';
    questions = shuffle(sortedQuestions);
    
    return sortedQuestions;

}

function hideSelector(selector) {
    selector.className = "hide";

}

function showSelector(selector) {
    selector.className = "flex";
}

function showNextQuestion() {
    clearInterval(timer);
    if (questions.length == 0) {
        showResults()
    } else {
        var currentQuestion = questions.pop();
        var question = currentQuestion[1];
        var inquire = question['question'];
        var solution = question['answer'];
        choices = question['choices'];
        
        var inquireText = document.createTextNode(inquire);
        var choice1Picture = document.createElement('img');
        var choice2Picture = document.createElement('img');
        var choice3Picture = document.createElement('img');
        var choice4Picture = document.createElement('img');
        
        var choice1Node = document.createTextNode("text" in choices[1] ? choices[1]["text"] : '');
        var choice2Node = document.createTextNode("text" in choices[2] ? choices[2]["text"] : '');
        var choice3Node = document.createTextNode("text" in choices[3] ? choices[3]["text"] : '');
        var choice4Node = document.createTextNode("text" in choices[4] ? choices[4]["text"] : '');
        
        var solutionNode = document.createTextNode(solution);
        

        choice1Picture.src="image" in choices[1] ? choices[1]["image"] : '';
        choice2Picture.src="image" in choices[2] ? choices[2]["image"] : '';
        choice3Picture.src="image" in choices[3] ? choices[3]["image"] : '';
        choice4Picture.src="image" in choices[4] ? choices[4]["image"] : '';
        
        questionText.append(inquireText);

        option1Text.append(choice1Node);
        option2Text.append(choice2Node);
        option3Text.append(choice3Node);
        option4Text.append(choice4Node);
            
        option1ImageFront.append(choice1Picture);
        option2ImageFront.append(choice2Picture);
        option3ImageFront.append(choice3Picture);
        option4ImageFront.append(choice4Picture);
        
        answer.append(solutionNode);
    }
    countdownTimer()
}

function resolveQuestion(e) {
    unanswered = 0;
    clearInterval(timer);

    var correctFlag = false;
    var keyPressed = e.key;
    var correctAnswer = answer.childNodes[0].data;
    if (keyPressed == correctAnswer) {
        correct++;
        correctFlag = true;
    }

    option1.getElementsByClassName('flip-card')[0].classList.add('hover');
    option2.getElementsByClassName('flip-card')[0].classList.add('hover');
    option3.getElementsByClassName('flip-card')[0].classList.add('hover');
    option4.getElementsByClassName('flip-card')[0].classList.add('hover');

    var choice1Solution = document.createTextNode("solution" in choices[1] ? choices[1]["solution"] : '');
    var choice2Solution = document.createTextNode("solution" in choices[2] ? choices[2]["solution"] : '');
    var choice3Solution = document.createTextNode("solution" in choices[3] ? choices[3]["solution"] : '');
    var choice4Solution = document.createTextNode("solution" in choices[4] ? choices[4]["solution"] : '');

    option1Solution.append(choice1Solution);
    option2Solution.append(choice2Solution);
    option3Solution.append(choice3Solution);
    option4Solution.append(choice4Solution);

    sleep(4000).then(() => clearQuestion());
    sleep(4000).then(() => showNextQuestion());
}

function clearQuestion() {
    option1.classList.remove("text-muted", "text-success", "text-danger");
    option2.classList.remove("text-muted", "text-success", "text-danger");
    option3.classList.remove("text-muted", "text-success", "text-danger");

    option1.getElementsByClassName('flip-card')[0].classList.remove('hover');
    option2.getElementsByClassName('flip-card')[0].classList.remove('hover');
    option3.getElementsByClassName('flip-card')[0].classList.remove('hover');
    option4.getElementsByClassName('flip-card')[0].classList.remove('hover');

    option1Text.innerText = '';
    option2Text.innerText = '';
    option3Text.innerText = '';
    option4Text.innerText='';

    option1Solution.innerText='';
    option2Solution.innerText='';
    option3Solution.innerText='';
    option4Solution.innerText='';

    option1ImageFront.innerHTML = '';
    option2ImageFront.innerHTML = '';
    option3ImageFront.innerHTML = '';
    option4ImageFront.innerHTML = '';

    questionText.innerText = '';
    answer.innerText='';
}

function shuffle(a) {
    var j, x, i;
    for (i = a.length - 1; i > 0; i--) {
        j = Math.floor(Math.random() * (i + 1));
        x = a[i];
        a[i] = a[j];
        a[j] = x;
    }
    return a;
}

async function countdownTimer()
{
    if (unanswered >3) {
        showResults();
    }
    timer = setInterval(() => {
        sleep(500).then(() => clearQuestion());
        sleep(500).then(() => showNextQuestion());
        unanswered++;
        showNextQuestion();
    }, 5000);
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

function showResults()
{
    var inquireText = document.createTextNode(correct);
    questionText.append(inquireText);
    sleep(1000).then(() => location.reload());
}
